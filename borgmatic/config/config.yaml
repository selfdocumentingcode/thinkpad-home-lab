source_directories:
  - /mnt/source/lab-docker-volumes

repositories:
  - path: /mnt/borg-repository/repo

# Allow backing up subdirectories mounted as docker volumes under configured source directory(s)
one_file_system: false

compression: zlib # good, but slow
# compression: lz4 # fast, low compression ratio

archive_name_format: 'lab-backup-{now:%Y-%m-%d-%H-%M-%S}'

exclude_patterns:
  - '*/log/*'
  - '*/logs/*'
  - '*.log'
  - '*/cache/*'
  - '*.cache'
  - '*/freshrss-data/favicons/*'
  - '*/librechat-mongodb/diagnostic.data/*'

keep_daily: 7
keep_weekly: 4
keep_monthly: 12
keep_yearly: 10

checks:
  - name: repository
    frequency: 2 weeks
  - name: archives
    frequency: always
  - name: extract
    frequency: 2 weeks
  - name: data
    frequency: 1 month

commands:
  - before: everything
    when:
      - create
    run:
      - echo "Starting a new job."

  - after: everything
    when:
      - create
    run:
      - echo "Backup created."

  - after: error
    when:
      - create
      - prune
      - compact
      - check
    run:
      - echo "Error while creating a backup."

# healthchecks:
#   ping_url: ${BORG_HEALTHCHECK_URL}

